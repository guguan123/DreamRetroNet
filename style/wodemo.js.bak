kQuery=function(a,b){return kQuery.prototype.find(a,b)};kQuery.prototype={find:function(a,e){var b=[],c,d=Object.create(kQuery.prototype);if(typeof a=="object"){d.currentElements=[a];return d}if(e){c=e.currentElements}else{c=[document]}kQuery.each(c,function(h,g){var j=h.querySelectorAll(a);var f=j.length,g;for(g=0;g<f;++g){b.push(j[g])}});d.currentElements=b;return d},on:function(a,b){this.each(function(d,c){if(d.addEventListener){d.addEventListener(a,b)}else{d.attachEvent("on"+a,b)}})},addClass:function(a){this.each(function(c,b){if(c.classList){c.classList.add(a)}else{c.className+=" "+a}})},removeClass:function(a){this.each(function(c,b){if(c.classList){c.classList.remove(a)}else{c.className=c.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," ")}})},attr:function(a,b){if(typeof b=="undefined"){if(this.currentElements.length<=0){return null}return this.currentElements[0].getAttribute(a)}else{return this.each(function(d,c){if(b===false){d.removeAttribute(a)}else{d.setAttribute(a,b)}})}},val:function(a){if(typeof a=="undefined"){if(this.currentElements.length<=0){return null}return this.currentElements[0].value}else{return this.each(function(c,b){c.value=a})}},html:function(a){if(typeof a=="undefined"){if(this.currentElements.length<=0){return null}return this.currentElements[0].innerHTML}else{return this.each(function(c,b){c.innerHTML=a})}},css:function(a,d){if(typeof d=="undefined"){if(this.currentElements.length<=0){return null}var c=this.currentElements[0],b;if(window.getComputedStyle!="undefined"){styles=window.getComputedStyle(c)}else{styles=c.style}return styles[a]}else{return this.each(function(f,e){f.style[a]=d})}},each:function(a){return kQuery.each(this.currentElements,a)}};kQuery.each=function(b,d){var a=b.length,c;for(c=0;c<a;++c){d(b[c],c)}};kQuery.ajax=function(h,a,g,d,e){if(XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.open(h,a,true);xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){var i;if(e=="json"){i=JSON.parse(xmlhttp.responseText)}else{if(e=="xml"){i=xmlhttp.responseXML}else{i=xmlhttp.responseText}}d(i,true)}};if(h=="POST"){var f=null,c;for(var b in g){c=encodeURIComponent(b)+"="+encodeURIComponent(g[b]);if(f){f+="&"+c}else{f=c}}xmlhttp.send(f)}else{xmlhttp.send()}},kQuery.get=function(a,b,c){return kQuery.ajax("GET",a,null,b,c)},kQuery.post=function(a,d,b,c){return kQuery.ajax("POST",a,d,b,c)};kQuery.ready=function(a){if(document.addEventListener){document.addEventListener("DOMContentLoaded",a,false)}else{window.attachEvent("onload",a)}};$=kQuery;function ge(a){return document.getElementById(a)}function wo_check_reg_form(){var h=ge("reg_form");var k=[];var e=WoLang,d,c;e.setGroup("user");if(h.username.value==""){k.push(e._("error_empty"))}else{if(h.username.value.length<2){k.push(e._("error_short"))}else{if(/^[a-zA-Z\d]{2,10}$/.test(h.username.value)==false){k.push(e._("error_name_invalid"))}}}if(h.userpass.value==""){k.push(e._("error_password_empty"))}else{if(h.userpass.value!=h.reuserpass.value){k.push(e._("error_password_not_same"))}}if(k.length>0){var j=ge("reg_form_warning");j.innerHTML="";var b=k.length;for(var g=0;g<b;++g){j.innerHTML+=k[g]+"<br />"}return false}return true}function wo_more_screenshot(){var a=document.createElement("input");a.setAttribute("type","file");a.setAttribute("name","screenshots[]");var b=document.createElement("br");ge("screenshots_container").appendChild(a);ge("screenshots_container").appendChild(b)}WoDom={maxId:0,caches:{},e:function(a,g,c){var f=document.createElement(a),b,d;this.appendText(f,g);b=c.length;for(d=0;d<b;++d){f.setAttribute(c[d][0],c[d][1])}return f},appendText:function(b,c){var a=document.createTextNode(c);b.appendChild(a)},eachClass:function(c,b,a){var d;if(a){d=a.getElementsByClassName(c)}else{d=document.getElementsByClassName(c)}return this.eachElement(d,b)},eachTagName:function(d,b,a){var c;if(a){c=a.getElementsByTagName(d)}else{c=document.getElementsByTagName(d)}return this.eachElement(c,b)},eachElement:function(d,c){var a,b;a=d.length;for(b=0;b<a;++b){if(c(d.item(b))===false){return}}},eById:function(a){return document.getElementById(a)},removeEvents:function(d,b){var a=d.getAttribute("woid");if(!a){return}var c=this.getCache(a);if(d.removeEventListener){return d.removeEventListener(b,c)}else{b="on"+b;return d.attachEvent(b,c)}},addEvent:function(d,b,c){var a=d.getAttribute("woid");if(!a){a=this.createCacheId();d.setAttribute("woid",a)}this.setCache(a,c);if(d.addEventListener){return d.addEventListener(b,c,false)}else{if(d.attachEvent){return d.attachEvent(b,c)}}},setCache:function(b,a){return this.caches[b]=a},getCache:function(a){return this.caches[a]},createCacheId:function(){++this.maxId;return this.maxId}};WoCompose={container:null,index:0,types:["text","image","audio","attachment"],init:function(b){this.container=ge(b);this.container.innerHTML="";this.container.appendChild(WoDom.e("table","",[["id","compose-sections"]]));this.sectionContainer=ge("compose-sections");var j=this.types.length,g="",k;var d=WoLang,m,f;d.setGroup("compose");for(var e=0;e<j;++e){k=this.types[e];m=WoDom.e("a","+"+d._(k),[["href","javascript:void()"],["onclick","WoCompose.add('"+k+"');return false;"]]);this.container.appendChild(m);WoDom.appendText(this.container," ")}var h=WoDom.eById("compose-site"),n=this,c=h.options[h.selectedIndex].value;n.showCategory(c);WoDom.addEvent(h,"change",function(){c=h.options[h.selectedIndex].value;n.showCategory(c)})},showCategory:function(a){WoDom.eById("compose-category").innerHTML=WoDom.eById("site-category-"+a).innerHTML},add:function(b,c){var f=this.sectionContainer,d="",a;if(b=="text"){d+=this.getHtmlText(c);d+='<input type="hidden" name="type['+this.index+']" value="'+b+'" />'}else{d+=this.getHtmlFile(b,c)}d+='<input type="hidden" name="order__'+this.index+'" value="'+this.index+'" />';a=WoDom.e("tr","",[["class","section"],["section",this.index]]);a.innerHTML=d;f.appendChild(a);this.addHandlers();++this.index},getHtmlText:function(f){var d='<td colspan="2"><div>'+this.getHtmlSectionOp(),b,e,a=WoLang;a.setGroup("compose");b=[["markdown","Markdown"],["text",a._("plaintext")],["html","HTML"]];d+='<select class="wo-compose-text-options" name="texttype__'+this.index+'">';for(var c=0;c<b.length;++c){e="";if(f&&f.texttype==b[c][0]){e='selected="selected"'}d+='<option value="'+b[c][0]+'"'+e+">"+b[c][1]+"</option>"}d+="<select>";d+=this.getHtmlHelp(f);d+='</div><textarea name="contents__'+this.index+'">';if(f){d+=WoUtil.escapeHtml(f.contents)}d+="</textarea></td>";return d},getHtmlHelp:function(c){var b="",a="wo-compose-text-help-button-"+this.index;b+=' <span class="'+a+'">';b+='<a href="#" class="wo-toggle-link" onclick="WoUtil.toggle(\'.wo-compose-text-help-'+this.index+"');return false\"> +help </a></span>";b+='<div class="wo-hidden wo-compose-text-help-'+this.index+'">';b+="<h3>Markdown Examples</h3>";b+="[link title](http://example.com)<br /><br />## Header 2<br />### Header 3<br />#### Header 4<br />##### Header 5<br />###### Header 6<br /><br />-   List item 1<br />-   List item 2<br />-   List item 3<br /><br />1. Ordered list item 1<br />2. Ordered list item 2<br />3. Ordered list item 3<br /><br />``` <br />Code<br />Code<br />``` <br /><br />This is a ~~strike~~ word.<br /><br />This is an __important__ word.<br /><br /><br />- [ ] A todo task.<br />- [x] A done task.<br /><br />&gt; Quote<br />&gt; Quote<br />&gt; Quote<br /><br />First Column  | Second Column<br />---------------- | ---------------<br />Content Row  | Content Row<br />Content Row  | Content Row<br /><br />&lt;p style=&quot;color:red&quot;&gt;HTML works here too&lt;/p&gt;<br /><br />";b+="<h3>Macros</h3>";b+="{WO.ENTRY.FILES.N.URL} - The URL for Nth file<br /> ----- For example {WO.ENTRY.FILES.1.URL}<br />";b+="{WO.ENTRY.FILES.N.NAME} - The file name for Nth file<br />";b+="{WO.ENTRY.FILES.N.EXT} - The file extension for Nth file<br />";b+="<br /><br />";b+="</div>";return b},getHtmlFile:function(h,d){var b=WoLang,e="",a="",j="";b.setGroup("compose");e+='<td style="wo-compose-attachment-title">';var f=this.types.length,g,k;e+='<select name="type['+this.index+']">';for(var c=0;c<f;++c){g=this.types[c];if(g=="text"){continue}if(g==h){k='selected="selected"'}else{k=""}e+="<option "+k+' value="'+g+'">'+b._(g)+"</option>"}e+="</select>";e+="</td>";e+='<td class="upload">';if(d){a=d.filename;j=d.fileext;e+='<input type="hidden" name="filehexid__'+this.index+'" value="'+WoUtil.escapeHtml(d.filehexid)+'" />'}else{e+='<input type="file" name="contents__'+this.index+'" /><br />'}if(!a){a=""}if(!j){j=""}e+=b._("filename")+' <input type="text" name="filename__'+this.index+'" value="'+WoUtil.escapeHtml(a)+'" />.<input type="text" class="input-fileext" name="fileext__'+this.index+'" value="'+WoUtil.escapeHtml(j)+'" /><span> '+this.getHtmlSectionOp()+"</span>";e+="</td>";return e},getHtmlSectionOp:function(){var a=WoLang;a.setGroup("compose");return'<a class="up" href="javascript:void(0)">'+a._("up")+'</a> <a class="down" href="javascript:void(0)">'+a._("down")+'</a> <a class="remove" href="javascript:void(0)">'+a._("remove")+"</a> "},addHandlers:function(){var a=this;WoDom.eachClass("section",function(b){WoDom.eachClass("up",a.handleUp,b);WoDom.eachClass("down",a.handleDown,b);WoDom.eachClass("remove",a.handleRemove,b);WoDom.eachClass("wo-compose-text-options",function(c){a.handleHelp(c,a)},b)},this.sectionContainer)},handleHelp:function(b,c){var a=WoLang;a.setGroup("compose");WoDom.removeEvents(b,"change");WoDom.addEvent(b,"change",function(){var f=b.nextSibling,d,e;var g=b.options[b.selectedIndex].getAttribute("value");if(f.nodeName!="span"){f=f.nextSibling}d="inline-block";e=$(f);e.css("display",d)})},handleRemove:function(b){var a=WoLang;a.setGroup("compose");WoDom.removeEvents(b,"click");WoDom.addEvent(b,"click",function(){if(window.confirm(a._("You really want to remove?"))){WoCompose.sectionContainer.removeChild(b.parentNode.parentNode.parentNode)}})},handleDown:function(a){WoDom.removeEvents(a,"click");WoDom.addEvent(a,"click",function(){var c=a.parentNode.parentNode.parentNode;var b=c.nextSibling;if(!b||b.nodeName.toLowerCase()!="tr"){return}WoCompose.handleMove(b,c)})},handleUp:function(a){WoDom.removeEvents(a,"click");WoDom.addEvent(a,"click",function(){var c=a.parentNode.parentNode.parentNode;var b=c.previousSibling;if(!b||b.nodeName.toLowerCase()!="tr"){return}WoCompose.handleMove(c,b)})},handleMove:function(b,a){WoCompose.sectionContainer.insertBefore(b,a);WoDom.eachTagName("input",function(c){if(c.getAttribute("name").indexOf("order__")===0){input_value=parseInt(c.getAttribute("value"));c.setAttribute("value",input_value+1)}},a);WoDom.eachTagName("input",function(c){if(c.getAttribute("name").indexOf("order__")===0){input_value=parseInt(c.getAttribute("value"));c.setAttribute("value",input_value-1)}},b)},generateUrlMappingFromTitle:function(){try{var a=$(".compose-title").val();a=a.toLocaleLowerCase().replace(/^[^0-9a-z]+/,"").replace(/[^0-9a-z]+$/,"").replace(/[^0-9a-z]/g,"-").replace(/-{2,}/g,"-");if(a.length==""){alert("There is no 0-9 and a-z in the title")}else{$(".wo-compose-url-input").val("/"+a)}}catch(b){alert(b);alert("Failed to generate")}}};WoUtil={escapeHtml:function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/>/g,"&gt;").replace(/</g,"&lt;")},loginIfNeeded:function(b){if(typeof WoUser.grantString!="undefined"){var a="/wdm/sso/grant?i="+encodeURIComponent(WoUser.grantString);a+="&return_to="+encodeURIComponent(b),window.location=a}},refreshIfTaskDone:function(a){$.get("/wdm/task/"+a+"?r="+Math.random(),function(b){var c=b.data["status"];if(c=="waiting"||c=="processing"){setTimeout(function(){WoUtil.refreshIfTaskDone(a)},3000)}else{if(b.data["status"]=="done"){location.reload(true)}}},"json")},toggle:function(a,b){var d=$(a);var c=d.css("display");if(c=="none"){if(!b){b="block"}d.css("display",b)}else{d.css("display","none")}},addReplyAt:function(b){var c=".wo-reply-textarea",a;a=$(c).val();if(a){a+=" "}a=a+b;$(c).val(a)},initDock:function(){var a="/admin/site";$(".dock-write-article").each(function(b){$(b).on("click",function(){var d=$(b).attr("siteid");var e=$(".site-category-"+d).val();var c=a+"/compose?site_id="+d+"&cid="+e;window.location.href=c})});$(".dock-upload-file").each(function(b){$(b).on("click",function(){var d=$(b).attr("siteid");var e=$(".site-category-"+d).val();var c=a+"/upload?site_id="+d+"&cid="+e;window.location.href=c})})},init:function(a){this.loginIfNeeded(a);if(WoUser.notificationCount>=0){kQuery(".wo-n-count-block").css("display","inline");kQuery(".wo-n-count-num").html(WoUser.notificationCount)}}};WoTemplateEditor={customTemplates:{},defaultTemplates:{},setTemplateName:function(a){this.name=a},setCustomTemplate:function(a){this.customTemplates[this.name]=a},setDefaultTemplate:function(a){this.defaultTemplates[this.name]=a},onTypeChange:function(d,b){this.setTemplateName(b);var c=kQuery("select[name="+b+"_template_type]").val();var a="textarea[name="+b+"_template_contents]";if(c=="default"){if(typeof d=="undefined"||d==""){WoTemplateEditor.setCustomTemplate(kQuery(a).val())}kQuery(a).val(WoTemplateEditor.defaultTemplates[b]);kQuery(a).attr("disabled","disabled");kQuery(a).css("color","gray")}else{kQuery(a).val(WoTemplateEditor.customTemplates[b]);kQuery(a).attr("disabled",false);kQuery(a).css("color","black")}}};